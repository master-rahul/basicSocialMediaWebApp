let likeListenser=function(){document.querySelectorAll(" .like").forEach((e=>{e.addEventListener("click",(t=>{t.preventDefault();var n=$(e).data("id");$.ajax({type:"get",url:$(e).prop("href"),data:{id:$(e).data("id"),type:$(e).data("type")},success:function(e){let t;console.log("liked"),t=e.data.deleted?notification("Unliked Successfully","success"):notification("Liked Successfully","success"),$(`#like-${n}`).html(e.data.likes),$("#flash-message").append(t)},error:function(e,t,n){let o=notification("Post Not Able To Like","error");$("#flash-message").append(o),console.log("Error: "+n)}})}))}))},createPost=function(){$("#new-post-form").submit((function(e){e.preventDefault();JSON.stringify($(this).serializeArray());$.ajax({type:"POST",url:"/post/create",data:$(this).serialize(),success:function(e){var t=e.data.post._id;console.log("id ::: ",t);let n=newPostDom(e.data);$("#text-content").val(""),$("#post-list-container>ul").prepend(n);let o=notification("Post Added Successfully","success");$("#flash-message").append(o),deletePost($(" .post-delete",n)),commentListener($(" .post-comment",n));new ToggleLike($(" .like",n))},error:function(e,t,n){console.log("Error: "+n)}})}))},newPostDom=function(e){var t=new Date(e.post.updatedAt).toLocaleDateString("en-US",{weekday:"short",year:"numeric",month:"short",day:"numeric"});return $(`\n            <li id="post-${e.post._id}" class="post-list">\n            <a class="post-delete" href="/post/delete/${e.post._id}" id="post-delete-${e.post._id}"style="border: blue solid 2px; padding : 1px 5px; border-radius: 15%; box-shadow: 2px 2px 1px blue;">X</a> &nbsp;&nbsp;\n            ${e.post.content}\n            <div style="padding: 5px; margin-left: 30px;">\n                <form action="/comment/create" class="post-comment" id="post-comment-${e.post._id}" method="POST">\n                        <input type="hidden" name="postId" value="${e.post._id}">\n                        <input type="text" name="content"  id="comment-text-${e.post._id}" placeholder="Enter Your Comment.." required style="height: 20px; width: 400px; padding: 2px 5px;">\n                        <button type="submit">Send</button>\n                </form>\n            </div>\n            <div class="post-comments-list">\n                <ul id="post-comments-${e.post._id}">\n                </ul>\n            </div>\n            <br>\n             <div style="display: inline;">\n                <a href="/likes/toggle" data-type="Post" data-id="${e.post._id}" class="like" style="text-decoration: none;"> \n                    <img src="/icons/like_button.png" id="image1" style="height: 15px; width: 20px; object-fit: contain;">\n                </a><p id="like-${e.post._id}" style="display: inline;">0</p> Likes\n            </div>\n            <div style="display: inline; padding: 5px; margin-left: 500px; border-bottom: lightgrey solid 1px;">\n                <small><i> By : <u>${e.name}</u>, UpdatedAt : <u>${t}</u></i></small>\n            </div>\n        </li>\n        <br>\n    `)},deletePost=function(e){$(e).click((function(t){t.preventDefault(),$.ajax({type:"get",url:$(e).prop("href"),success:function(e){let t=notification("Post Deleted Successfully","success");$("#flash-message").append(t),$(`#post-${e.data.posts_id}`).remove()},error:function(e,t,n){notification("Error In Deleting Post","success");console.log("Error: "+n)}})}))},commentListener=function(e){console.log(e),$(e).submit((t=>{t.preventDefault(),$.ajax({type:"POST",url:"/comment/create",data:e.serialize(),success:function(e){let t=newCommentDom(e.data);$(`#comment-text-${e.data.comment.post}`).val(""),$(`#post-comments-${e.data.comment.post}`).prepend(t);let n=notification("Comment Added Successfully","success");$("#flash-message").append(n),deleteComment($(" .comment-delete",t));new ToggleLike($(" .like",t))},error:function(e,t,n){notification("Error In Adding Comment","success");console.log("Error: "+n)}})}))},likeListenserDynamic=function(e){$(e).click((t=>{t.preventDefault();var n=$(e).data("id");$.ajax({type:"get",url:$(e).prop("href"),data:{id:$(e).data("id"),type:$(e).data("type")},success:function(e){let t;console.log("liked"),t=e.data.deleted?notification("Unliked Successfully","success"):notification("Liked Successfully","success"),$(`#like-${n}`).html(e.data.likes),$("#flash-message").append(t)},error:function(e,t,n){let o=notification("Post Not Able To Like","error");$("#flash-message").append(o),console.log("Error: "+n)}})}))},deleteComment=function(e){$(e).click((t=>{t.preventDefault(),$.ajax({type:"GET",url:$(e).prop("href"),success:function(e){let t=notification("Comment Deleted Successfully","success");$("#flash-message").append(t),$(`#comment-${e.data.comment._id}`).remove()},error:function(e,t,n){console.log("Error: "+n)}})}))},newCommentDom=function(e){var t=new Date(e.comment.updatedAt).toLocaleDateString("en-US",{weekday:"short",year:"numeric",month:"short",day:"numeric"});return $(`\n        <li id="comment-${e.comment._id}" class="comment-list" style="border: skyblue solid 1px; padding: 5px 5px;">\n            <a href="/comment/delete/${e.comment._id}" class="comment-delete" id="comment-delete-${e.comment._id}"style="border: blue solid 1px; padding : 0px 4px; border-radius: 15%; box-shadow: 2px 2px 1px blue;">X</a>&nbsp;&nbsp;\n            ${e.comment.content} \n            <br>\n            <div style="padding: 10px 10px;">\n                <div style="display: inline;" >\n                     <a href= "/likes/toggle" data-type="Comment" data-id="${e.comment._id}" class="like" style="text-decoration: none;">\n                        <img src="/icons/like_button.png" id="image1" style="height: 13px; width: 20px; object-fit: contain;">\n                    </a><p id="like-${e.comment._id}" style="display: inline;">0</p> Likes\n                </div>\n                <div style="display: inline; padding: 5px; margin-left: 400px;">\n                   <small><i>By : <u> ${e.name} </u>, UpdatedAt : <u> ${t}</u></i></small>\n                </div>\n            </div>\n            \n        </li>\n    `)},notification=function(e,t){return $(`<script> new Noty({\n                theme : 'relax',\n                type : '${t}',\n                text : '${e}',\n                layout : 'topRight',\n                timeout : 500\n            }).show();<\/script>`)};createPost();let allPostDelete=function(){document.querySelectorAll(" .post-delete").forEach((e=>{e.addEventListener("click",(t=>{t.preventDefault(),$.ajax({type:"get",url:$(e).prop("href"),success:function(e){let t=notification("Post Deleted Successfully","success");$("#flash-message").append(t),$(`#post-${e.data.posts_id}`).remove()},error:function(e,t,n){console.log("Error: "+n)}})}))}))},allCommentDelete=function(){document.querySelectorAll(" .comment-delete").forEach((e=>{e.addEventListener("click",(t=>{t.preventDefault(),$.ajax({type:"GET",url:$(e).prop("href"),success:function(e){let t=notification("Comment Deleted Successfully","success");$("#flash-message").append(t),$(`#comment-${e.data.comment._id}`).remove()},error:function(e,t,n){console.log("Error :"+n)}})}))}))},allCommentListener=function(){document.querySelectorAll(" .post-comment").forEach((e=>{e.addEventListener("submit",(t=>{console.log("I am here"),t.preventDefault(),$.ajax({type:"POST",url:"/comment/create",data:$(e).serialize(),success:function(e){let t=newCommentDom(e.data);$(`#comment-text-${e.data.comment.post}`).val(""),$(`#post-comments-${e.data.comment.post}`).prepend(t);let n=notification("Comment Added Successfully","success");$("#flash-message").append(n),deleteComment($(" .comment-delete",t))},error:function(e,t,n){console.log("Error: "+n)}})}))}))};allPostDelete(),allCommentDelete(),allCommentListener();